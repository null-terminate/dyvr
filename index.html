<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>dyvr</title>
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      font-size: 13px;
      line-height: 1.4;
      color: #333;
      background-color: #f5f5f5;
      height: 100vh;
      overflow: hidden;
    }

    /* Main application layout */
    .app-container {
      display: flex;
      height: 100vh;
      flex-direction: column;
    }

    /* Application header */
    .app-header {
      background-color: #fff;
      border-bottom: 1px solid #e0e0e0;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 44px;
      z-index: 100;
    }

    .app-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .breadcrumb {
      font-size: 12px;
      color: #666;
      display: flex;
      align-items: center;
    }

    .breadcrumb-separator {
      margin: 0 8px;
      color: #999;
    }

    /* Main content layout */
    .main-layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* Left sidebar */
    .sidebar {
      width: 280px;
      min-width: 280px;
      background-color: #fff;
      border-right: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid #e0e0e0;
      background-color: #fafafa;
    }

    .sidebar-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
    }

    /* Main content area */
    .content-area {
      flex: 1;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e0e0e0;
      background-color: #fafafa;
    }

    .content-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }

    .content-subtitle {
      font-size: 13px;
      color: #666;
    }

    .content-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      background-color: #fff;
      color: #333;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.15s ease;
    }

    .btn:hover {
      background-color: #f5f5f5;
      border-color: #b0b0b0;
    }

    .btn:active {
      background-color: #e8e8e8;
      transform: translateY(1px);
    }

    .btn-primary {
      background-color: #007aff;
      border-color: #007aff;
      color: #fff;
    }

    .btn-primary:hover {
      background-color: #0056cc;
      border-color: #0056cc;
    }

    .btn-primary:active {
      background-color: #004499;
    }

    .btn-small {
      padding: 4px 8px;
      font-size: 12px;
    }

    /* Empty state */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      color: #666;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-state-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .empty-state-description {
      font-size: 13px;
      margin-bottom: 20px;
      max-width: 300px;
    }

    /* Project list styles */
    .project-item {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      margin: 2px 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.15s ease;
      position: relative;
    }

    .project-item:hover {
      background-color: #f0f0f0;
    }

    .project-item.selected {
      background-color: #007aff;
      color: #fff;
    }

    .project-item.selected:hover {
      background-color: #0056cc;
    }

    .project-icon {
      font-size: 16px;
      margin-right: 10px;
      opacity: 0.8;
    }

    .project-info {
      flex: 1;
      min-width: 0;
    }

    .project-name {
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .project-path {
      font-size: 11px;
      opacity: 0.7;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 2px;
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      width: 480px;
      max-width: 90vw;
      max-height: 90vh;
      overflow: hidden;
    }

    .modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e0e0e0;
      background-color: #fafafa;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid #e0e0e0;
      background-color: #fafafa;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    /* Form styles */
    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #333;
      margin-bottom: 6px;
    }

    .form-input {
      width: 100%;
      padding: 8px 12px;
      font-size: 13px;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      background-color: #fff;
      color: #333;
      transition: border-color 0.15s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .form-input.error {
      border-color: #ff3b30;
    }

    .form-error {
      font-size: 12px;
      color: #ff3b30;
      margin-top: 4px;
    }

    .form-help {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    .file-picker {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .file-picker-input {
      flex: 1;
    }

    .btn-secondary {
      background-color: #f0f0f0;
      border-color: #d0d0d0;
      color: #333;
    }

    .btn-secondary:hover {
      background-color: #e0e0e0;
      border-color: #b0b0b0;
    }

    /* Context menu styles */
    .context-menu {
      position: fixed;
      background-color: #fff;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      padding: 4px 0;
      min-width: 150px;
      z-index: 1001;
    }

    .context-menu-item {
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }

    .context-menu-item:hover {
      background-color: #f0f0f0;
    }

    .context-menu-item.danger {
      color: #ff3b30;
    }

    .context-menu-item.danger:hover {
      background-color: #ff3b30;
      color: #fff;
    }

    .context-menu-separator {
      height: 1px;
      background-color: #e0e0e0;
      margin: 4px 0;
    }

    /* Utility classes */
    .hidden {
      display: none !important;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    /* Project detail styles */
    .project-detail-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .project-info-section,
    .source-folders-section,
    .views-section {
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .info-card {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 16px;
    }

    .info-row {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .info-row:last-child {
      margin-bottom: 0;
    }

    .info-label {
      font-weight: 500;
      color: #495057;
      min-width: 140px;
      margin-right: 12px;
    }

    .info-value {
      color: #333;
      flex: 1;
    }

    .info-value-with-action {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .source-folders-list,
    .views-list {
      border: 1px solid #e9ecef;
      border-radius: 8px;
      background-color: #fff;
    }

    .folder-item,
    .view-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid #e9ecef;
      transition: background-color 0.15s ease;
    }

    .folder-item:last-child,
    .view-item:last-child {
      border-bottom: none;
    }

    .folder-item:hover,
    .view-item:hover {
      background-color: #f8f9fa;
    }

    .folder-icon,
    .view-icon {
      font-size: 16px;
      margin-right: 12px;
      opacity: 0.7;
    }

    .folder-info,
    .view-info {
      flex: 1;
      min-width: 0;
    }

    .folder-path,
    .view-name {
      font-size: 13px;
      font-weight: 500;
      color: #333;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .folder-added,
    .view-created {
      font-size: 11px;
      color: #666;
    }

    .folder-actions,
    .view-actions {
      display: flex;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.15s ease;
    }

    .folder-item:hover .folder-actions,
    .view-item:hover .view-actions {
      opacity: 1;
    }

    .btn-danger {
      background-color: #dc3545;
      border-color: #dc3545;
      color: #fff;
    }

    .btn-danger:hover {
      background-color: #c82333;
      border-color: #bd2130;
    }

    .empty-list {
      padding: 32px 16px;
      text-align: center;
      color: #666;
    }

    .empty-list-icon {
      font-size: 32px;
      margin-bottom: 12px;
      opacity: 0.3;
    }

    .empty-list-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
      color: #333;
    }

    .empty-list-description {
      font-size: 12px;
    }

    /* Scrollbar styling for webkit browsers */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Application Header -->
    <header class="app-header">
      <div class="app-title">Dyvr</div>
      <nav class="breadcrumb" id="breadcrumb">
        <span>Projects</span>
      </nav>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
      <!-- Left Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-title">Projects</div>
          <button class="btn btn-primary btn-small" id="create-project-btn">
            + New Project
          </button>
        </div>
        <div class="sidebar-content" id="project-list">
          <!-- Project list will be populated here -->
          <div class="empty-state">
            <div class="empty-state-icon">üìÅ</div>
            <div class="empty-state-title">No Projects</div>
            <div class="empty-state-description">
              Create your first project to get started organizing your work.
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="content-area">
        <div class="content-header">
          <div class="content-title" id="content-title">Welcome</div>
          <div class="content-subtitle" id="content-subtitle">
            Select a project from the sidebar to view its details
          </div>
        </div>
        <div class="content-body" id="content-body">
          <div class="empty-state">
            <div class="empty-state-icon">üëã</div>
            <div class="empty-state-title">Welcome to Project Manager</div>
            <div class="empty-state-description">
              This application helps you organize and manage your projects with associated working directories and
              source data folders. Start by creating your first project using the button in the sidebar.
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Create Project Modal -->
  <div class="modal-overlay hidden" id="create-project-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Create New Project</div>
      </div>
      <div class="modal-body">
        <form id="create-project-form">
          <div class="form-group">
            <label class="form-label" for="project-name">Project Name</label>
            <input type="text" class="form-input" id="project-name" placeholder="Enter project name" required>
            <div class="form-error hidden" id="project-name-error"></div>
          </div>
          <div class="form-group">
            <label class="form-label" for="working-directory">Working Directory</label>
            <div class="file-picker">
              <input type="text" class="form-input file-picker-input" id="working-directory"
                placeholder="Select working directory" readonly required>
              <button type="button" class="btn btn-secondary" id="browse-directory-btn">
                Browse...
              </button>
            </div>
            <div class="form-help">
              Choose a directory where project files will be stored
            </div>
            <div class="form-error hidden" id="working-directory-error"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancel-create-btn">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" id="confirm-create-btn" form="create-project-form">
          Create Project
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay hidden" id="delete-project-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Delete Project</div>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete "<span id="delete-project-name"></span>"?</p>
        <p style="margin-top: 8px; font-size: 12px; color: #666;">
          This will remove the project from the list but will not delete the working directory or its contents.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancel-delete-btn">
          Cancel
        </button>
        <button type="button" class="btn btn-primary" id="confirm-delete-btn"
          style="background-color: #ff3b30; border-color: #ff3b30;">
          Delete Project
        </button>
      </div>
    </div>
  </div>

  <!-- Add Source Folder Modal -->
  <div class="modal-overlay hidden" id="add-source-folder-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Add Source Data Folder</div>
      </div>
      <div class="modal-body">
        <form id="add-source-folder-form">
          <div class="form-group">
            <label class="form-label" for="source-folder-path">Folder Path</label>
            <div class="file-picker">
              <input type="text" class="form-input file-picker-input" id="source-folder-path"
                placeholder="Select source data folder" readonly required>
              <button type="button" class="btn btn-secondary" id="browse-source-folder-btn">
                Browse...
              </button>
            </div>
            <div class="form-help">
              Choose a folder containing source data files for this project
            </div>
            <div class="form-error hidden" id="source-folder-path-error"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancel-add-source-folder-btn">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" id="confirm-add-source-folder-btn" form="add-source-folder-form">
          Add Folder
        </button>
      </div>
    </div>
  </div>

  <!-- Create View Modal -->
  <div class="modal-overlay hidden" id="create-view-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Create New View</div>
      </div>
      <div class="modal-body">
        <form id="create-view-form">
          <div class="form-group">
            <label class="form-label" for="view-name">View Name</label>
            <input type="text" class="form-input" id="view-name" placeholder="Enter view name" required>
            <div class="form-help">
              Choose a descriptive name for this data view
            </div>
            <div class="form-error hidden" id="view-name-error"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancel-create-view-btn">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" id="confirm-create-view-btn" form="create-view-form">
          Create View
        </button>
      </div>
    </div>
  </div>

  <!-- Remove Source Folder Confirmation Modal -->
  <div class="modal-overlay hidden" id="remove-source-folder-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Remove Source Folder</div>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to remove this source folder from the project?</p>
        <p style="margin-top: 8px; font-size: 12px; color: #666;">
          <strong>Path:</strong> <span id="remove-source-folder-path"></span>
        </p>
        <p style="margin-top: 8px; font-size: 12px; color: #666;">
          This will only remove the reference from the project. The actual folder and its contents will not be deleted.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancel-remove-source-folder-btn">
          Cancel
        </button>
        <button type="button" class="btn btn-danger" id="confirm-remove-source-folder-btn">
          Remove Folder
        </button>
      </div>
    </div>
  </div>

  <!-- Delete View Confirmation Modal -->
  <div class="modal-overlay hidden" id="delete-view-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Delete View</div>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the view "<span id="delete-view-name"></span>"?</p>
        <p style="margin-top: 8px; font-size: 12px; color: #666;">
          This will permanently delete the view and all associated data. This action cannot be undone.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancel-delete-view-btn">
          Cancel
        </button>
        <button type="button" class="btn btn-danger" id="confirm-delete-view-btn">
          Delete View
        </button>
      </div>
    </div>
  </div>

  <!-- Context Menu -->
  <div class="context-menu hidden" id="project-context-menu">
    <div class="context-menu-item" id="context-delete-project">
      Delete Project
    </div>
  </div>

  <script>
    // Application state
    let projects = [];
    let selectedProjectId = null;
    let contextMenuProjectId = null;

    // Basic UI initialization
    document.addEventListener('DOMContentLoaded', function () {
      console.log('Project Manager UI loaded');

      // Initialize breadcrumb navigation
      updateBreadcrumb(['Projects']);

      // Initialize event listeners
      initializeEventListeners();

      // Load projects from main process
      loadProjects();
    });

    // Initialize all event listeners
    function initializeEventListeners() {
      // Create project button
      const createProjectBtn = document.getElementById('create-project-btn');
      createProjectBtn.addEventListener('click', showCreateProjectModal);

      // Create project modal events
      const cancelCreateBtn = document.getElementById('cancel-create-btn');
      const confirmCreateBtn = document.getElementById('confirm-create-btn');
      const browseDirectoryBtn = document.getElementById('browse-directory-btn');
      const createProjectForm = document.getElementById('create-project-form');

      cancelCreateBtn.addEventListener('click', hideCreateProjectModal);
      browseDirectoryBtn.addEventListener('click', browseWorkingDirectory);
      createProjectForm.addEventListener('submit', handleCreateProject);

      // Delete project modal events
      const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
      const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

      cancelDeleteBtn.addEventListener('click', hideDeleteProjectModal);
      confirmDeleteBtn.addEventListener('click', handleDeleteProject);

      // Context menu events
      const contextDeleteBtn = document.getElementById('context-delete-project');
      contextDeleteBtn.addEventListener('click', showDeleteProjectModal);

      // Add source folder modal events
      const cancelAddSourceFolderBtn = document.getElementById('cancel-add-source-folder-btn');
      const confirmAddSourceFolderBtn = document.getElementById('confirm-add-source-folder-btn');
      const browseSourceFolderBtn = document.getElementById('browse-source-folder-btn');
      const addSourceFolderForm = document.getElementById('add-source-folder-form');

      cancelAddSourceFolderBtn.addEventListener('click', hideAddSourceFolderModal);
      browseSourceFolderBtn.addEventListener('click', browseSourceFolder);
      addSourceFolderForm.addEventListener('submit', handleAddSourceFolder);

      // Create view modal events
      const cancelCreateViewBtn = document.getElementById('cancel-create-view-btn');
      const confirmCreateViewBtn = document.getElementById('confirm-create-view-btn');
      const createViewForm = document.getElementById('create-view-form');

      cancelCreateViewBtn.addEventListener('click', hideCreateViewModal);
      createViewForm.addEventListener('submit', handleCreateView);

      // Remove source folder modal events
      const cancelRemoveSourceFolderBtn = document.getElementById('cancel-remove-source-folder-btn');
      const confirmRemoveSourceFolderBtn = document.getElementById('confirm-remove-source-folder-btn');

      cancelRemoveSourceFolderBtn.addEventListener('click', hideRemoveSourceFolderModal);
      confirmRemoveSourceFolderBtn.addEventListener('click', handleRemoveSourceFolder);

      // Delete view modal events
      const cancelDeleteViewBtn = document.getElementById('cancel-delete-view-btn');
      const confirmDeleteViewBtn = document.getElementById('confirm-delete-view-btn');

      cancelDeleteViewBtn.addEventListener('click', hideDeleteViewModal);
      confirmDeleteViewBtn.addEventListener('click', handleDeleteView);

      // Close modals and context menu when clicking outside
      document.addEventListener('click', handleDocumentClick);

      // Close context menu on right click elsewhere
      document.addEventListener('contextmenu', function (e) {
        if (!e.target.closest('.project-item')) {
          hideContextMenu();
        }
      });

      // Prevent default context menu on project items
      document.addEventListener('contextmenu', function (e) {
        if (e.target.closest('.project-item')) {
          e.preventDefault();
        }
      });
    }

    // Load projects from main process
    function loadProjects() {
      // Check if window.api is available (it should be in Electron environment)
      if (window.api) {
        console.log('Index: Using Electron API to load projects');
        
        // Set up event listener for projects loaded
        window.api.onProjectsLoaded((loadedProjects) => {
          console.log('Index: Received projects from main process:', loadedProjects);
          projects = loadedProjects;
          renderProjectList();
        });
        
        // Request projects to be loaded
        console.log('Index: Requesting projects from main process');
        window.api.loadProjects();
      } else {
        console.warn('Index: Electron API not available, using empty projects list');
        projects = [];
        renderProjectList();
      }
    }

    // Render the project list in the sidebar
    function renderProjectList() {
      const projectListContainer = document.getElementById('project-list');

      if (projects.length === 0) {
        projectListContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìÅ</div>
            <div class="empty-state-title">No Projects</div>
            <div class="empty-state-description">
              Create your first project to get started organizing your work.
            </div>
          </div>
        `;
        return;
      }

      const projectItems = projects.map(project => `
        <div class="project-item ${project.id === selectedProjectId ? 'selected' : ''}" 
             data-project-id="${project.id}">
          <div class="project-icon">üìÅ</div>
          <div class="project-info">
            <div class="project-name">${escapeHtml(project.name)}</div>
            <div class="project-path">${escapeHtml(project.workingDirectory)}</div>
          </div>
        </div>
      `).join('');

      projectListContainer.innerHTML = projectItems;

      // Add event listeners to project items
      const projectElements = projectListContainer.querySelectorAll('.project-item');
      projectElements.forEach(element => {
        element.addEventListener('click', handleProjectClick);
        element.addEventListener('contextmenu', handleProjectRightClick);
      });
    }

    // Handle project item click
    function handleProjectClick(e) {
      const projectId = e.currentTarget.dataset.projectId;
      selectProject(projectId);
    }

    // Handle project item right click
    function handleProjectRightClick(e) {
      e.preventDefault();
      const projectId = e.currentTarget.dataset.projectId;
      contextMenuProjectId = projectId;
      showContextMenu(e.clientX, e.clientY);
    }

    // Select a project
    function selectProject(projectId) {
      selectedProjectId = projectId;
      renderProjectList();

      const project = projects.find(p => p.id === projectId);
      if (project) {
        updateContentArea(project);
      }
    }

    // Update the main content area with project details
    function updateContentArea(project) {
      const contentTitle = document.getElementById('content-title');
      const contentSubtitle = document.getElementById('content-subtitle');
      const contentBody = document.getElementById('content-body');

      contentTitle.textContent = project.name;
      contentSubtitle.textContent = `Working Directory: ${project.workingDirectory}`;

      // Update breadcrumb to show project detail
      updateBreadcrumb(['Projects', project.name]);

      contentBody.innerHTML = `
        <div class="project-detail-container">
          <!-- Project Information Section -->
          <section class="project-info-section">
            <h3 class="section-title">Project Information</h3>
            <div class="info-card">
              <div class="info-row">
                <span class="info-label">Name:</span>
                <span class="info-value">${escapeHtml(project.name)}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Working Directory:</span>
                <div class="info-value-with-action">
                  <span class="info-value">${escapeHtml(project.workingDirectory)}</span>
                  <button class="btn btn-small btn-secondary" onclick="openInExplorer('${escapeHtml(project.workingDirectory)}')">
                    Open in Explorer
                  </button>
                </div>
              </div>
              <div class="info-row">
                <span class="info-label">Created:</span>
                <span class="info-value">${project.createdDate.toLocaleDateString()}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Last Modified:</span>
                <span class="info-value">${project.lastModified.toLocaleDateString()}</span>
              </div>
            </div>
          </section>

          <!-- Source Data Folders Section -->
          <section class="source-folders-section">
            <div class="section-header">
              <h3 class="section-title">Source Data Folders</h3>
              <button class="btn btn-primary btn-small" onclick="showAddSourceFolderDialog('${project.id}')">
                + Add Folder
              </button>
            </div>
            <div class="source-folders-list" id="source-folders-list-${project.id}">
              ${renderSourceFoldersList(project.sourceFolders || [])}
            </div>
          </section>

          <!-- Views Section -->
          <section class="views-section">
            <div class="section-header">
              <h3 class="section-title">Views</h3>
              <button class="btn btn-primary btn-small" onclick="showCreateViewDialog('${project.id}')">
                + Create View
              </button>
            </div>
            <div class="views-list" id="views-list-${project.id}">
              ${renderViewsList(project.views || [])}
            </div>
          </section>
        </div>
      `;
    }

    // Show create project modal
    function showCreateProjectModal() {
      const modal = document.getElementById('create-project-modal');
      modal.classList.remove('hidden');

      // Clear form
      document.getElementById('project-name').value = '';
      document.getElementById('working-directory').value = '';
      clearFormErrors();

      // Focus on project name input
      setTimeout(() => {
        document.getElementById('project-name').focus();
      }, 100);
    }

    // Hide create project modal
    function hideCreateProjectModal() {
      const modal = document.getElementById('create-project-modal');
      modal.classList.add('hidden');
      clearFormErrors();
    }

    // Browse for working directory
    function browseWorkingDirectory() {
      // This would normally use Electron's dialog API
      // For now, we'll simulate with a prompt
      const directory = prompt('Enter working directory path:');
      if (directory) {
        document.getElementById('working-directory').value = directory;
        clearFieldError('working-directory');
      }
    }

    // Handle create project form submission
    function handleCreateProject(e) {
      e.preventDefault();

      const projectName = document.getElementById('project-name').value.trim();
      const workingDirectory = document.getElementById('working-directory').value.trim();

      // Validate form
      let hasErrors = false;

      if (!projectName) {
        showFieldError('project-name', 'Project name is required');
        hasErrors = true;
      } else if (projects.some(p => p.name.toLowerCase() === projectName.toLowerCase())) {
        showFieldError('project-name', 'A project with this name already exists');
        hasErrors = true;
      }

      if (!workingDirectory) {
        showFieldError('working-directory', 'Working directory is required');
        hasErrors = true;
      }

      if (hasErrors) {
        return;
      }

      // Create new project
      const newProject = {
        id: Date.now().toString(),
        name: projectName,
        workingDirectory: workingDirectory,
        createdDate: new Date(),
        lastModified: new Date(),
        sourceFolders: [],
        views: []
      };

      projects.push(newProject);
      renderProjectList();
      selectProject(newProject.id);
      hideCreateProjectModal();
    }

    // Render source folders list
    function renderSourceFoldersList(sourceFolders) {
      if (!sourceFolders || sourceFolders.length === 0) {
        return `
          <div class="empty-list">
            <div class="empty-list-icon">üìÇ</div>
            <div class="empty-list-title">No Source Folders</div>
            <div class="empty-list-description">Add source data folders to reference external data sources for this project.</div>
          </div>
        `;
      }

      return sourceFolders.map(folder => `
        <div class="folder-item">
          <div class="folder-icon">üìÇ</div>
          <div class="folder-info">
            <div class="folder-path">${escapeHtml(folder.path)}</div>
            <div class="folder-added">Added ${folder.addedDate ? new Date(folder.addedDate).toLocaleDateString() : 'Unknown'}</div>
          </div>
          <div class="folder-actions">
            <button class="btn btn-small btn-secondary" onclick="openInExplorer('${escapeHtml(folder.path)}')">
              Open
            </button>
            <button class="btn btn-small btn-danger" onclick="showRemoveSourceFolderDialog('${selectedProjectId}', '${escapeHtml(folder.path)}')">
              Remove
            </button>
          </div>
        </div>
      `).join('');
    }

    // Render views list
    function renderViewsList(views) {
      if (!views || views.length === 0) {
        return `
          <div class="empty-list">
            <div class="empty-list-icon">üìä</div>
            <div class="empty-list-title">No Views</div>
            <div class="empty-list-description">Create views to analyze and query the data in your source folders.</div>
          </div>
        `;
      }

      return views.map(view => `
        <div class="view-item">
          <div class="view-icon">üìä</div>
          <div class="view-info">
            <div class="view-name">${escapeHtml(view.name)}</div>
            <div class="view-created">Created ${view.createdDate ? new Date(view.createdDate).toLocaleDateString() : 'Unknown'}</div>
          </div>
          <div class="view-actions">
            <button class="btn btn-small btn-primary" onclick="openView('${selectedProjectId}', '${view.id}')">
              Open
            </button>
            <button class="btn btn-small btn-danger" onclick="showDeleteViewDialog('${selectedProjectId}', '${view.id}', '${escapeHtml(view.name)}')">
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    // Show add source folder dialog
    function showAddSourceFolderDialog(projectId) {
      const modal = document.getElementById('add-source-folder-modal');
      modal.classList.remove('hidden');

      // Store project ID for later use
      modal.dataset.projectId = projectId;

      // Clear form
      document.getElementById('source-folder-path').value = '';
      clearFormErrors();

      // Focus on folder path input
      setTimeout(() => {
        document.getElementById('source-folder-path').focus();
      }, 100);
    }

    // Show create view dialog
    function showCreateViewDialog(projectId) {
      const modal = document.getElementById('create-view-modal');
      modal.classList.remove('hidden');

      // Store project ID for later use
      modal.dataset.projectId = projectId;

      // Clear form
      document.getElementById('view-name').value = '';
      clearFormErrors();

      // Focus on view name input
      setTimeout(() => {
        document.getElementById('view-name').focus();
      }, 100);
    }

    // Show remove source folder dialog
    function showRemoveSourceFolderDialog(projectId, folderPath) {
      const modal = document.getElementById('remove-source-folder-modal');
      const pathSpan = document.getElementById('remove-source-folder-path');

      modal.classList.remove('hidden');
      modal.dataset.projectId = projectId;
      modal.dataset.folderPath = folderPath;
      pathSpan.textContent = folderPath;
    }

    // Show delete view dialog
    function showDeleteViewDialog(projectId, viewId, viewName) {
      const modal = document.getElementById('delete-view-modal');
      const nameSpan = document.getElementById('delete-view-name');

      modal.classList.remove('hidden');
      modal.dataset.projectId = projectId;
      modal.dataset.viewId = viewId;
      nameSpan.textContent = viewName;
    }

    // Open folder in system explorer
    function openInExplorer(folderPath) {
      // This would normally use Electron's shell API
      // For now, we'll just show an alert
      alert(`Would open folder: ${folderPath}`);
      console.log('Opening folder in explorer:', folderPath);
    }

    // Open a view
    function openView(projectId, viewId) {
      // This would normally navigate to the data view screen
      // For now, we'll just show an alert
      alert(`Would open view: ${viewId} in project: ${projectId}`);
      console.log('Opening view:', viewId, 'in project:', projectId);
    }

    // Handle create project form submission
    function handleCreateProject(e) {
      e.preventDefault();

      const projectName = document.getElementById('project-name').value.trim();
      const workingDirectory = document.getElementById('working-directory').value.trim();

      // Validate form
      let hasErrors = false;

      if (!projectName) {
        showFieldError('project-name', 'Project name is required');
        hasErrors = true;
      } else if (projects.some(p => p.name.toLowerCase() === projectName.toLowerCase())) {
        showFieldError('project-name', 'A project with this name already exists');
        hasErrors = true;
      }

      if (!workingDirectory) {
        showFieldError('working-directory', 'Working directory is required');
        hasErrors = true;
      }

      if (hasErrors) {
        return;
      }

      // Create new project
      const newProject = {
        id: Date.now().toString(),
        name: projectName,
        workingDirectory: workingDirectory,
        createdDate: new Date(),
        lastModified: new Date(),
        sourceFolders: [],
        views: []
      };

      projects.push(newProject);
      renderProjectList();
      selectProject(newProject.id);
      hideCreateProjectModal();
    }

    // Handle add source folder form submission
    function handleAddSourceFolder(e) {
      e.preventDefault();

      const modal = document.getElementById('add-source-folder-modal');
      const projectId = modal.dataset.projectId;
      const folderPath = document.getElementById('source-folder-path').value.trim();

      // Validate form
      let hasErrors = false;

      if (!folderPath) {
        showFieldError('source-folder-path', 'Folder path is required');
        hasErrors = true;
      }

      if (hasErrors) {
        return;
      }

      // Find the project and add the source folder
      const project = projects.find(p => p.id === projectId);
      if (project) {
        // Check for duplicates
        if (project.sourceFolders && project.sourceFolders.some(f => f.path === folderPath)) {
          showFieldError('source-folder-path', 'This folder is already added to the project');
          return;
        }

        // Initialize sourceFolders if it doesn't exist
        if (!project.sourceFolders) {
          project.sourceFolders = [];
        }

        // Add the source folder
        project.sourceFolders.push({
          id: Date.now().toString(),
          path: folderPath,
          addedDate: new Date()
        });

        project.lastModified = new Date();

        // Update the UI if this project is currently selected
        if (selectedProjectId === projectId) {
          updateContentArea(project);
        }
      }

      hideAddSourceFolderModal();
    }

    // Handle create view form submission
    function handleCreateView(e) {
      e.preventDefault();

      const modal = document.getElementById('create-view-modal');
      const projectId = modal.dataset.projectId;
      const viewName = document.getElementById('view-name').value.trim();

      // Validate form
      let hasErrors = false;

      if (!viewName) {
        showFieldError('view-name', 'View name is required');
        hasErrors = true;
      }

      if (hasErrors) {
        return;
      }

      // Find the project and add the view
      const project = projects.find(p => p.id === projectId);
      if (project) {
        // Check for duplicates
        if (project.views && project.views.some(v => v.name.toLowerCase() === viewName.toLowerCase())) {
          showFieldError('view-name', 'A view with this name already exists in this project');
          return;
        }

        // Initialize views if it doesn't exist
        if (!project.views) {
          project.views = [];
        }

        // Add the view
        project.views.push({
          id: Date.now().toString(),
          name: viewName,
          createdDate: new Date(),
          lastModified: new Date()
        });

        project.lastModified = new Date();

        // Update the UI if this project is currently selected
        if (selectedProjectId === projectId) {
          updateContentArea(project);
        }
      }

      hideCreateViewModal();
    }

    // Handle remove source folder
    function handleRemoveSourceFolder() {
      const modal = document.getElementById('remove-source-folder-modal');
      const projectId = modal.dataset.projectId;
      const folderPath = modal.dataset.folderPath;

      // Find the project and remove the source folder
      const project = projects.find(p => p.id === projectId);
      if (project && project.sourceFolders) {
        project.sourceFolders = project.sourceFolders.filter(f => f.path !== folderPath);
        project.lastModified = new Date();

        // Update the UI if this project is currently selected
        if (selectedProjectId === projectId) {
          updateContentArea(project);
        }
      }

      hideRemoveSourceFolderModal();
    }

    // Handle delete view
    function handleDeleteView() {
      const modal = document.getElementById('delete-view-modal');
      const projectId = modal.dataset.projectId;
      const viewId = modal.dataset.viewId;

      // Find the project and remove the view
      const project = projects.find(p => p.id === projectId);
      if (project && project.views) {
        project.views = project.views.filter(v => v.id !== viewId);
        project.lastModified = new Date();

        // Update the UI if this project is currently selected
        if (selectedProjectId === projectId) {
          updateContentArea(project);
        }
      }

      hideDeleteViewModal();
    }

    // Hide add source folder modal
    function hideAddSourceFolderModal() {
      const modal = document.getElementById('add-source-folder-modal');
      modal.classList.add('hidden');
      clearFormErrors();
    }

    // Hide create view modal
    function hideCreateViewModal() {
      const modal = document.getElementById('create-view-modal');
      modal.classList.add('hidden');
      clearFormErrors();
    }

    // Hide remove source folder modal
    function hideRemoveSourceFolderModal() {
      const modal = document.getElementById('remove-source-folder-modal');
      modal.classList.add('hidden');
    }

    // Hide delete view modal
    function hideDeleteViewModal() {
      const modal = document.getElementById('delete-view-modal');
      modal.classList.add('hidden');
    }

    // Browse for source folder
    function browseSourceFolder() {
      // This would normally use Electron's dialog API
      // For now, we'll simulate with a prompt
      const directory = prompt('Enter source folder path:');
      if (directory) {
        document.getElementById('source-folder-path').value = directory;
        clearFieldError('source-folder-path');
      }
    }

    // Show delete project modal
    function showDeleteProjectModal() {
      const project = projects.find(p => p.id === contextMenuProjectId);
      if (!project) return;

      const modal = document.getElementById('delete-project-modal');
      const projectNameSpan = document.getElementById('delete-project-name');

      projectNameSpan.textContent = project.name;
      modal.classList.remove('hidden');
      hideContextMenu();
    }

    // Hide delete project modal
    function hideDeleteProjectModal() {
      const modal = document.getElementById('delete-project-modal');
      modal.classList.add('hidden');
    }

    // Handle delete project
    function handleDeleteProject() {
      if (!contextMenuProjectId) return;

      projects = projects.filter(p => p.id !== contextMenuProjectId);

      // If deleted project was selected, clear selection
      if (selectedProjectId === contextMenuProjectId) {
        selectedProjectId = null;
        resetContentArea();
      }

      renderProjectList();
      hideDeleteProjectModal();
      contextMenuProjectId = null;
    }

    // Show context menu
    function showContextMenu(x, y) {
      const contextMenu = document.getElementById('project-context-menu');
      contextMenu.style.left = x + 'px';
      contextMenu.style.top = y + 'px';
      contextMenu.classList.remove('hidden');
    }

    // Hide context menu
    function hideContextMenu() {
      const contextMenu = document.getElementById('project-context-menu');
      contextMenu.classList.add('hidden');
    }

    // Reset content area to welcome state
    function resetContentArea() {
      const contentTitle = document.getElementById('content-title');
      const contentSubtitle = document.getElementById('content-subtitle');
      const contentBody = document.getElementById('content-body');

      contentTitle.textContent = 'Welcome';
      contentSubtitle.textContent = 'Select a project from the sidebar to view its details';

      contentBody.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">üëã</div>
          <div class="empty-state-title">Welcome to Project Manager</div>
          <div class="empty-state-description">
            This application helps you organize and manage your projects with associated working directories and source data folders. Start by creating your first project using the button in the sidebar.
          </div>
        </div>
      `;
    }

    // Handle document clicks to close modals and context menu
    function handleDocumentClick(e) {
      // Close context menu if clicking outside
      const contextMenu = document.getElementById('project-context-menu');
      if (!contextMenu.classList.contains('hidden') && !e.target.closest('.context-menu')) {
        hideContextMenu();
      }

      // Close modals if clicking on overlay
      if (e.target.classList.contains('modal-overlay')) {
        hideCreateProjectModal();
        hideDeleteProjectModal();
        hideAddSourceFolderModal();
        hideCreateViewModal();
        hideRemoveSourceFolderModal();
        hideDeleteViewModal();
      }
    }

    // Form validation helpers
    function showFieldError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const errorElement = document.getElementById(fieldId + '-error');

      field.classList.add('error');
      errorElement.textContent = message;
      errorElement.classList.remove('hidden');
    }

    function clearFieldError(fieldId) {
      const field = document.getElementById(fieldId);
      const errorElement = document.getElementById(fieldId + '-error');

      field.classList.remove('error');
      errorElement.classList.add('hidden');
    }

    function clearFormErrors() {
      const errorElements = document.querySelectorAll('.form-error');
      const inputElements = document.querySelectorAll('.form-input');

      errorElements.forEach(el => el.classList.add('hidden'));
      inputElements.forEach(el => el.classList.remove('error'));
    }

    // Utility function to update breadcrumb navigation
    function updateBreadcrumb(path) {
      const breadcrumb = document.getElementById('breadcrumb');
      if (breadcrumb && path && path.length > 0) {
        breadcrumb.innerHTML = path.map((item, index) => {
          if (index === path.length - 1) {
            return `<span>${item}</span>`;
          } else {
            return `<span>${item}</span><span class="breadcrumb-separator">‚Ä∫</span>`;
          }
        }).join('');
      }
    }

    // Utility function to show loading state
    function setLoadingState(element, loading) {
      if (loading) {
        element.classList.add('loading');
      } else {
        element.classList.remove('loading');
      }
    }

    // Utility function to show/hide elements
    function toggleElement(element, show) {
      if (show) {
        element.classList.remove('hidden');
      } else {
        element.classList.add('hidden');
      }
    }

    // Utility function to escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
